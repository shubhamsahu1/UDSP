"use strict";(self.webpackChunkapplication_init_client=self.webpackChunkapplication_init_client||[]).push([[502],{1502:(e,t,s)=>{s.r(t),s.d(t,{default:()=>C});var a=s(5043),r=s(6446),n=s(7254),i=s(3845),l=s(5865),o=s(3336),c=s(8903),d=s(5795),x=s(1906),h=s(1637),m=s(2110),u=s(6494),p=s(9336),A=s(5846),j=s(7967),y=s(7968),v=s(4117),g=s(5016),b=s(6305);const f=async(e,t)=>{try{return(await b.Ay.get("/reports/data",{params:{startDate:e,endDate:t}})).data}catch(a){var s;throw(null===(s=a.response)||void 0===s?void 0:s.data)||{success:!1,message:"Network error"}}},w=async(e,t)=>{try{const s=await b.Ay.get("/reports/export-csv",{params:{startDate:e,endDate:t},responseType:"blob"}),a=window.URL.createObjectURL(new Blob([s.data])),r=document.createElement("a");return r.href=a,r.setAttribute("download","UDSP_Report_".concat(e,"_to_").concat(t,".csv")),document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(a),{success:!0,message:"CSV downloaded successfully"}}catch(a){var s;throw(null===(s=a.response)||void 0===s?void 0:s.data)||{success:!1,message:"Network error"}}},S=async(e,t)=>{try{return(await b.Ay.get("/reports/summary",{params:{startDate:e,endDate:t}})).data}catch(a){var s;throw(null===(s=a.response)||void 0===s?void 0:s.data)||{success:!1,message:"Network error"}}};var k=s(7589),T=s(579);const C=()=>{const{t:e}=(0,v.Bd)(),{user:t}=(0,g.A)(),[s,b]=(0,a.useState)(new Date(Date.now()-2592e6).toISOString().split("T")[0]),[C,D]=(0,a.useState)((new Date).toISOString().split("T")[0]),[P,R]=(0,a.useState)(null),[I,L]=(0,a.useState)([]),[N,_]=(0,a.useState)(null),[E,U]=(0,a.useState)(!1),[z,O]=(0,a.useState)(""),[W,q]=(0,a.useState)("");(0,a.useEffect)(()=>{"admin"===(null===t||void 0===t?void 0:t.role)||O("Access denied. Admin role required.")},[t]);if("admin"!==(null===t||void 0===t?void 0:t.role))return(0,T.jsx)(r.A,{children:(0,T.jsx)(n.A,{severity:"error",children:"Access denied. Admin role required."})});const F=[{field:"userName",headerName:"User Name",width:180,renderCell:e=>(0,T.jsx)("strong",{style:{fontWeight:"medium"},children:e.value})},...I.map(e=>({field:"labTest_".concat(e.id),headerName:e.name,width:180,align:"center",headerAlign:"center",renderCell:e=>{const t=e.value;return t?(0,T.jsxs)(r.A,{sx:{display:"flex",flexDirection:"column",gap:.2,width:"100%",alignItems:"center",mt:.5},children:[(0,T.jsxs)(r.A,{sx:{display:"flex",gap:1,justifyContent:"center"},children:[(0,T.jsx)(i.A,{label:t.sampleTaken,size:"small",color:t.sampleTaken>0?"primary":"default"}),(0,T.jsx)(i.A,{label:t.samplePositive,size:"small",color:t.samplePositive>0?"warning":"default"})]}),t.sampleTaken>0&&(0,T.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:[(t.samplePositive/t.sampleTaken*100).toFixed(1),"%"]})]}):null}}))],V=(P||[]).map((e,t)=>{const s={id:e.userId||t,userName:e.userName};return I.forEach(t=>{s["labTest_".concat(t.id)]=e.labTests[t.id]}),s});return(0,T.jsxs)(r.A,{children:[(0,T.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",mb:3},children:[(0,T.jsx)(A.A,{sx:{mr:2,color:"primary.main"}}),(0,T.jsx)(l.A,{variant:"h4",component:"h1",children:"UDSP Reports"})]}),z&&(0,T.jsx)(n.A,{severity:"error",sx:{mb:2},onClose:()=>O(""),children:z}),W&&(0,T.jsx)(n.A,{severity:"success",sx:{mb:2},onClose:()=>q(""),children:W}),(0,T.jsxs)(o.A,{sx:{p:3,mb:3},children:[(0,T.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,T.jsx)(j.A,{sx:{mr:1,color:"primary.main"}}),(0,T.jsx)(l.A,{variant:"h6",children:"Select Date Range"})]}),(0,T.jsxs)(c.Ay,{container:!0,spacing:3,alignItems:"center",children:[(0,T.jsx)(c.Ay,{item:!0,xs:12,sm:4,children:(0,T.jsx)(d.A,{fullWidth:!0,label:"Start Date",type:"date",value:s,onChange:e=>b(e.target.value),InputLabelProps:{shrink:!0},required:!0})}),(0,T.jsx)(c.Ay,{item:!0,xs:12,sm:4,children:(0,T.jsx)(d.A,{fullWidth:!0,label:"End Date",type:"date",value:C,onChange:e=>D(e.target.value),InputLabelProps:{shrink:!0},required:!0})}),(0,T.jsx)(c.Ay,{item:!0,xs:12,sm:4,children:(0,T.jsx)(x.A,{variant:"contained",onClick:async()=>{if(s&&C)if(new Date(s)>new Date(C))O("Start date must be before end date");else try{U(!0),O("");const[e,t]=await Promise.all([f(s,C),S(s,C)]);e.success?(R(e.data.reportData),L(e.data.labTests)):O(e.message||"Failed to fetch report data"),t.success&&_(t.data)}catch(e){O("Failed to fetch report data"),console.error("Fetch report data error:",e)}finally{U(!1)}else O("Please select both start and end dates")},disabled:E,size:"large",fullWidth:!0,children:E?(0,T.jsx)(h.A,{size:24}):"Generate Report"})})]})]}),N&&(0,T.jsxs)(c.Ay,{container:!0,spacing:3,sx:{mb:3},children:[(0,T.jsx)(c.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,T.jsx)(m.A,{children:(0,T.jsxs)(u.A,{children:[(0,T.jsx)(l.A,{variant:"h4",color:"primary",children:N.totalEntries}),(0,T.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Total Entries"})]})})}),(0,T.jsx)(c.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,T.jsx)(m.A,{children:(0,T.jsxs)(u.A,{children:[(0,T.jsx)(l.A,{variant:"h4",color:"info.main",children:N.uniqueUsers}),(0,T.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Active Users"})]})})}),(0,T.jsx)(c.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,T.jsx)(m.A,{children:(0,T.jsxs)(u.A,{children:[(0,T.jsx)(l.A,{variant:"h4",color:"success.main",children:N.totalSampleTaken.toLocaleString()}),(0,T.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Total Samples"})]})})}),(0,T.jsx)(c.Ay,{item:!0,xs:12,sm:6,md:3,children:(0,T.jsx)(m.A,{children:(0,T.jsxs)(u.A,{children:[(0,T.jsxs)(l.A,{variant:"h4",color:"warning.main",children:[N.positivityRate,"%"]}),(0,T.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Positivity Rate"})]})})})]}),P&&I.length>0&&(0,T.jsxs)(o.A,{sx:{mb:3},children:[(0,T.jsxs)(r.A,{sx:{p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,T.jsxs)(l.A,{variant:"h6",children:["Report Data (",s," to ",C,")"]}),(0,T.jsx)(x.A,{variant:"outlined",startIcon:(0,T.jsx)(y.A,{}),onClick:async()=>{if(s&&C)try{(await w(s,C)).success&&q("CSV file downloaded successfully")}catch(e){O("Failed to export CSV"),console.error("Export CSV error:",e)}else O("Please select date range and generate report first")},children:"Export CSV"})]}),(0,T.jsx)(p.A,{}),(0,T.jsx)(r.A,{sx:{height:600,width:"100%"},children:(0,T.jsx)(k.zh,{autoHeight:!0,rows:V,columns:F,pageSize:10,rowsPerPageOptions:[10,25,50],disableSelectionOnClick:!0,sx:{backgroundColor:"background.paper"},getRowHeight:()=>"auto",localeText:{noRowsLabel:"No data found for the selected date range."}})})]}),(null===N||void 0===N?void 0:N.labTestStats)&&N.labTestStats.length>0&&(0,T.jsxs)(o.A,{sx:{p:3},children:[(0,T.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Lab Test Statistics"}),(0,T.jsx)(c.Ay,{container:!0,spacing:2,children:N.labTestStats.map(e=>(0,T.jsx)(c.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,T.jsx)(m.A,{variant:"outlined",children:(0,T.jsxs)(u.A,{children:[(0,T.jsx)(l.A,{variant:"subtitle1",fontWeight:"medium",gutterBottom:!0,children:e.labTestName}),(0,T.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Entries: ",e.entryCount]}),(0,T.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Samples: ",e.totalSampleTaken.toLocaleString()]}),(0,T.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Positive: ",e.totalSamplePositive.toLocaleString()]}),(0,T.jsxs)(l.A,{variant:"body2",color:"primary",fontWeight:"medium",children:["Rate: ",e.positivityRate,"%"]})]})})},e.labTestId))})]})]})}}}]);
//# sourceMappingURL=502.3ba2e134.chunk.js.map